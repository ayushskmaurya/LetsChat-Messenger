{% extends 'layout.html' %}
{% block css %}
<link rel='stylesheet' type='text/css' href="{{ url_for('static', filename='css/chat.css') }}">
{% endblock %}

{% block body %}
<div class="outer-box">
	
	<!-- Chats division -->
	<div class="chats">
		<!-- Chats header division -->
		<div class="chats-header">
			<div class="title"><a href="/chat" class="title">LetsChat Messenger</a></div>
			<div class="menu-opts">
				<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-three-dots-vertical" viewBox="0 0 16 16">
					<path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
				</svg>
				<div class="opts-list">
					<button class="opt" data-bs-toggle="modal" data-bs-target="#contactsModal">Contacts</button>
					<button class="opt" data-bs-toggle="modal" data-bs-target="#profileModal">Profile</button>
					<button class="opt" onclick="window.location.replace('/signout');">Sign out</button>
				</div>
			</div>
		</div>

		<!-- User chats division -->
		<div class="user-chats">
			{% for chat in chats %}
				{% set userid = chat['userid'] %}
				{% set username = chat['username'] %}
				<button class="user-chat" onclick="chat('{{ userid }}', '{{ username }}');">{{ username }}</button>
			{% endfor %}
		</div>
	</div>

	<!-- Chat box division -->
	<div class="chat-box">
		<!-- User chat header division -->
		<div class="user-chat-header">
			<div class="user-name" id="user-name">admin</div>
		</div>

		<!-- Chat Window -->
		<div class="chat-window" id="chat-window">
			<div class="msg-container">
				<div class="msg rmsg">
					Welcome {{ name }}!
					<span class="dt">{{ cdt }}</span>
				</div>
			</div>
		</div>

		<!-- Send Message Division -->
		<div class="send-message">
			<div class="message">
				<textarea class="message" id="message" onkeydown="return (event.keyCode!=13);"></textarea>
			</div>
			<div class="send">
				<button class="send" id="send">Send</button>
			</div>
		</div>
	</div>
</div>

<!-- Contacts Modal -->
<div class="modal fade" id="contactsModal" tabindex="-1" aria-labelledby="contactsModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-scrollable">
		<div class="modal-content">
			<div class="modal-header contacts-header">
				<h5 class="modal-title" id="contactsModalLabel">Contacts</h5>
				<button type="button" class="btn create-contact" data-bs-toggle="modal" data-bs-target="#createContactModal">Create Contact</button>
				<button type="button" class="btn-close closeModal" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				{% for contact in contacts %}
					{% set userid = contact['userid'] %}
					{% set contactname = contact['contactname'] %}
					<button class="contact" onclick="chatWithContact('{{ userid }}', '{{ contactname }}');">{{ contactname }}</button>
				{% endfor %}
			</div>
		</div>
	</div>
</div>

<!-- Create Contact Modal -->
<div class="modal fade" id="createContactModal" tabindex="-1" aria-labelledby="createContactModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-scrollable">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="createContactModalLabel">Create new contact</h5>
				<button type="button" class="btn-close closeModal" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<div class="mb-3">
					<label for="uname" class="form-label">Username</label>
					<input type="text" class="form-control input" id="uname" placeholder="Enter username" required>
				</div>
				<div class="alert alert-danger" role="alert" style="display: none;" id="errorCreateContact"></div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary closeModal" data-bs-dismiss="modal">Close</button>
				<button type="button" class="btn create" onclick="createContact();">Create</button>
			</div>
		</div>
	</div>
</div>

<!-- Profile Modal -->
<div class="modal fade" id="profileModal" tabindex="-1" aria-labelledby="profileModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-scrollable">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="profileModalLabel">Profile</h5>
				<button type="button" class="btn-close closeModal" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<div class="mb-3">
					<span class="plabel">Name:</span>
					<p class="pinfo">{{ name }}</p>
				</div>
				<div class="mb-3">
					<span class="plabel">Username:</span>
					<p class="pinfo">{{ uname }}</p>
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock %}

<!-- Script -->
{% block script %}
<script src="{{ url_for('static', filename='js/chat.js') }}"></script>
{% endblock %}
